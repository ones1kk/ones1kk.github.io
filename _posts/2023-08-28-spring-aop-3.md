---
title: Spring AOP(3)
date: 2023-08-27 00:00:00 +09:00
categories: [ Spring Core ]
tags: [ AOP ]
---

# @EnableAspectJAutoProxy

기본적으로 ``ProxyFactory`` 클래스를 사용하여 AOP 프록시를 생성하고 관리할 수 있지만 이는 수동적이며 번거로운 작업입니다. 
그렇기 때문에 Spring은 프록시 생성과 관리의 작업을 자동화하고 추상화한 ``org.springframework.context.annotation.EnableAspectJAutoProxy`` 어노테이션을 제공합니다. 
``@EnableAspectJAutoProxy``는 IoC 컨테이너가 `` org.aspectj.lang.annotation.Aspect``가 적용된 클래스를 스캔하고, 필요한 프록시를 자동으로 생성하여 AOP를 적용할 수 있게끔 설정합니다. 

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Import(AspectJAutoProxyRegistrar.class)
public @interface EnableAspectJAutoProxy {

  /**
   * Indicate whether subclass-based (CGLIB) proxies are to be created as opposed
   * to standard Java interface-based proxies. The default is {@code false}.
   */
  boolean proxyTargetClass() default false;
  
  /**
   * Indicate that the proxy should be exposed by the AOP framework as a {@code ThreadLocal}
   * for retrieval via the {@link org.springframework.aop.framework.AopContext} class.
   * Off by default, i.e. no guarantees that {@code AopContext} access will work.
   * @since 4.3.1
   */
  boolean exposeProxy() default false;
}
```

- proxyTargetClass: AOP Proxy 전략을 설정합니다. 기본 값으로 ``false``이며 CGLIB를 사용하며 ``true``로 변경 시 JDK Dynamic을 사용합니다. 
- exposeProxy: 프록시 객체를 외부로 노출할지를 설정하는 필드입니다. 

# 동작 방식

먼저 동작 방식을 살펴 보기 이전에 Pointcut으로 활용할 어노테이션을 생성합니다. 

```java
@Retention(value = RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface SampleAop {
}
```

그 후 ``@Aspect`` 어노테이션으로 관리할  Advisor 클래스를 생성합니다. 
Advisor는 IoC 컨테이너에서 관리되어야 하기 때문에 Bean으로 등록합니다. 

![sample-aspect](/assets/img/spring/core/aop/sample-aspect.png)  








오탈자 및 오류 내용을 댓글 또는 메일로 알려주시면, 검토 후 조치하겠습니다.
